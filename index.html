<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Solo â€” Your AI Agent</title>
  <style>
    body {
      font-family: system-ui;
      background: #0f0f1b;
      color: #e0e0ff;
      padding: 16px;
      margin: 0;
      line-height: 1.5;
    }
    h2 {
      text-align: center;
      color: #6a5af9;
    }
    #chat {
      height: 70vh;
      overflow-y: auto;
      padding: 16px;
      border: 1px solid #3a3a5a;
      border-radius: 16px;
      margin-bottom: 16px;
      background: #1a1a2e;
    }
    .msg {
      margin-bottom: 12px;
      padding: 10px 14px;
      border-radius: 14px;
      max-width: 85%;
      word-wrap: break-word;
    }
    .user { background: #4A6CF7; margin-left: auto; }
    .agent { background: #2a2a4a; }
    input {
      width: 76%;
      padding: 14px;
      border: 1px solid #444;
      border-radius: 24px;
      background: #222;
      color: white;
      font-size: 16px;
    }
    button {
      width: 20%;
      padding: 14px;
      background: #6a5af9;
      color: white;
      border: none;
      border-radius: 24px;
      margin-left: 4px;
    }
    .thinking { color: #888; font-style: italic; }
  </style>
</head>
<body>
  <h2>ðŸ§  Solo â€” Your AI Agent</h2>
  <div id="chat"></div>
  <div>
    <input type="text" id="userInput" placeholder="Ask me anything..." />
    <button onclick="sendMessage()">Send</button>
  </div>

  <script>
    // ðŸ”‘ REPLACE THIS WITH YOUR GEMINI API KEY
    const API_KEY = "AIzaSyBRv8byvJ_WbYqK2b8lo74BGWo_an3Aav8";

    let memory = JSON.parse(localStorage.getItem('agent_memory') || '[]');

    function addMessage(role, text) {
      const chat = document.getElementById('chat');
      const div = document.createElement('div');
      div.className = `msg ${role}`;
      div.innerText = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
      memory.push({ role, parts: [{ text }] });
      localStorage.setItem('agent_memory', JSON.stringify(memory));
    }

    async function sendMessage() {
      const input = document.getElementById('userInput');
      const text = input.value.trim();
      if (!text) return;

      addMessage('user', text);
      input.value = '';
      document.getElementById('chat').innerHTML += '<div class="thinking">ðŸ§  Thinking...</div>';

      const prompt = `You are Solo, a helpful AI productivity agent. Respond naturally or use tools when needed.
Tools:
- create_task(title, due_date): due_date = YYYY-MM-DD
- log_habit(name)

User: ${text}
Agent:`;

      try {
        const res = await fetch(
          `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash-latest:generateContent?key=${API_KEY}`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
          }
        );
        const data = await res.json();
        const aiResponse = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || "I'm not sure how to help.";

        if (aiResponse.startsWith("TOOL:")) {
          handleToolCall(aiResponse);
        } else {
          document.querySelector('.thinking').remove();
          addMessage('agent', aiResponse);
        }
      } catch (err) {
        document.querySelector('.thinking').remove();
        addMessage('agent', "âš ï¸ Error. Check API key.");
      }
    }

    function handleToolCall(toolStr) {
      const toolPart = toolStr.split("TOOL:")[1];
      const [toolName, ...params] = toolPart.split("|");
      let result = "â“ Unknown command.";
      
      if (toolName === "create_task") {
        const title = params.find(p => p.startsWith("title="))?.split("=")[1] || "New task";
        const due = params.find(p => p.startsWith("due_date="))?.split("=")[1] || "ASAP";
        const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
        tasks.push({ title, due, completed: false });
        localStorage.setItem('tasks', JSON.stringify(tasks));
        result = `âœ… Task created: "${title}" (due ${due})`;
      } 
      else if (toolName === "log_habit") {
        const habit = params.find(p => p.startsWith("habit_name="))?.split("=")[1] || "Unknown habit";
        const logs = JSON.parse(localStorage.getItem('habit_logs') || '[]');
        logs.push({ habit, date: new Date().toISOString().split('T')[0] });
        localStorage.setItem('habit_logs', JSON.stringify(logs));
        result = `âœ… Logged habit: "${habit}" for today!`;
      }

      document.querySelector('.thinking').remove();
      addMessage('agent', result);
    }

    window.onload = () => {
      memory.forEach(msg => addMessage(msg.role, msg.parts[0].text));
      if (memory.length === 0) {
        addMessage('agent', "Hello! I'm Solo, your AI agent. How can I help?");
      }
    };
  </script>
</body>
</html>
